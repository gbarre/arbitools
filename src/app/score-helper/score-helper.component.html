<div class="container py-4">
  <h2 class="mb-4">Saisie manuelle d'une situation de tir</h2>

  <!-- Configuration -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title">Configuration</h5>

      <div class="row mb-3">
        <div class="col-md-6">
          <label class="form-label">Type de cible</label>
          <div class="d-flex gap-3">
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="spotType"
                id="monospot"
                value="monospot"
                [(ngModel)]="spotType"
                (change)="resetForm()"
              />
              <label class="form-check-label" for="monospot">
                Monospot
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="spotType"
                id="trispot"
                value="trispot"
                [(ngModel)]="spotType"
                (change)="resetForm()"
              />
              <label class="form-check-label" for="trispot">
                Trispot
              </label>
            </div>
          </div>
        </div>

        <div class="col-md-6">
          <label class="form-label">Type de tir</label>
          <div class="d-flex gap-3">
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="shootType"
                id="indoor"
                value="indoor"
                [(ngModel)]="shootType"
                (change)="resetForm()"
              />
              <label class="form-check-label" for="indoor">
                Tir en salle
              </label>
            </div>
            <div class="form-check">
              <input
                class="form-check-input"
                type="radio"
                name="shootType"
                id="field"
                value="field"
                [(ngModel)]="shootType"
                (change)="resetForm()"
              />
              <label class="form-check-label" for="field">
                Tir en campagne
              </label>
            </div>
          </div>
        </div>
      </div>

      <div class="row" *ngIf="shootType === 'field'">
        <div class="col-12">
          <div class="form-check">
            <input
              class="form-check-input"
              type="checkbox"
              id="lateWarning"
              [(ngModel)]="lateWarningGiven"
            />
            <label class="form-check-label" for="lateWarning">
              Avertissement hors temps déjà donné
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Saisie des flèches -->
  <div class="card mb-4">
    <div class="card-body">
      <h5 class="card-title mb-3">Flèches tirées</h5>

      <div class="row g-3">
        <div class="col-12" *ngFor="let arrow of arrows; let i = index">
          <div class="card">
            <div class="card-body">
              <div class="d-flex align-items-center justify-content-between mb-2">
                <h6 class="mb-0">Flèche {{ i + 1 }}</h6>
                <button
                  *ngIf="arrows.length > 3"
                  (click)="removeArrow(i)"
                  class="btn btn-sm btn-danger"
                  type="button"
                >
                  <i class="bi bi-trash"></i> Retirer
                </button>
              </div>

              <div class="row g-2 align-items-end">
                <div class="col-md-3">
                  <label [for]="'value-' + i" class="form-label">Valeur</label>
                  <select
                    *ngIf="shootType === 'indoor' && spotType === 'trispot'"
                    [id]="'value-' + i"
                    class="form-select"
                    [(ngModel)]="arrow.value"
                  >
                    <option [value]="0">0 (manqué)</option>
                    <option [value]="6">6</option>
                    <option [value]="7">7</option>
                    <option [value]="8">8</option>
                    <option [value]="9">9</option>
                    <option [value]="10">10</option>
                  </select>
                  <input
                    *ngIf="!(shootType === 'indoor' && spotType === 'trispot')"
                    [id]="'value-' + i"
                    type="number"
                    class="form-control"
                    min="0"
                    [max]="getMaxScore()"
                    [(ngModel)]="arrow.value"
                  />
                </div>

                <div class="col-md-3" *ngIf="spotType === 'trispot'">
                  <label [for]="'spot-' + i" class="form-label">Spot</label>
                  <select [id]="'spot-' + i" [(ngModel)]="arrow.spot" class="form-select">
                    <option [value]="1">1</option>
                    <option [value]="2">2</option>
                    <option [value]="3">3</option>
                  </select>
                </div>

                <div class="col-md-6">
                  <div class="form-check">
                    <input
                      [id]="'late-' + i"
                      class="form-check-input"
                      type="checkbox"
                      [(ngModel)]="arrow.isLate"
                    />
                    <label class="form-check-label" [for]="'late-' + i">
                      Hors temps
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="d-flex justify-content-between mt-3">
        <button
          (click)="calculateScore()"
          class="btn btn-primary"
          type="button"
        >
          Calculer le score
        </button>

        <button
          *ngIf="arrows.length < 5"
          (click)="addArrow()"
          class="btn btn-success"
          type="button"
        >
          <i class="bi bi-plus-circle"></i> Ajouter une flèche
        </button>
      </div>
    </div>
  </div>

  <!-- Bouton de calcul -->
  <div class="d-grid gap-2 mb-4">
  </div>

  <!-- Résultat -->
  <div class="card border-primary" *ngIf="result">
    <div class="card-header bg-primary text-white">
      <h5 class="mb-0">Résultat</h5>
    </div>
    <div class="card-body">
      <div class="row mb-3">
        <div class="col-md-6">
          <div class="alert alert-info mb-0">
            <h4 class="alert-heading">Score retenu</h4>
            <p class="display-6 mb-0">{{ result.retainedScore }}</p>
          </div>
        </div>
        <div class="col-md-6" *ngIf="result.penaltyCount > 0">
          <div class="alert alert-danger mb-0">
            <h4 class="alert-heading">Pénalités</h4>
            <p class="display-6 mb-0">{{ result.penaltyCount }}</p>
          </div>
        </div>
      </div>

      <div class="alert alert-light" *ngIf="explanation">
        <h5 class="alert-heading">Explication</h5>
        <div [innerHTML]="explanation"></div>
      </div>

      <div class="mt-3">
        <h5>Flèches conservées</h5>
        <ul class="list-group">
          <li class="list-group-item" *ngFor="let arrow of result.retainedArrows">
            <span *ngIf="isSpottedArrow(arrow)">
              <strong>Spot {{ arrow.spot }}</strong> : {{ arrow.value }}
              point{{ arrow.value > 1 ? 's' : '' }}
            </span>
            <span *ngIf="!isSpottedArrow(arrow)">
              {{ arrow.value }} point{{ arrow.value > 1 ? 's' : '' }}
            </span>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>
