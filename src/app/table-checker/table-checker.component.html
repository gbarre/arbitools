<h1>Table Checker</h1>
<p>
  Cette outil permet de tester vos connaissances sur divers tableaux présents
  dans le règlement.
</p>
<h2>Sélectionnez un tableau à compléter...</h2>
<div class="table-list">
  <div
    *ngFor="let tableKey of tables | keyvalue"
    (click)="selectTable(tableKey.key)"
    class="table-card"
    [class.bg-primary]="selectedTable?.name === tableKey.value.name"
    [class.text-white]="selectedTable?.name === tableKey.value.name">
    <h3>{{ tableKey.value.name }}</h3>
    <p
      [ngClass]="{
        'text-white': selectedTable?.name === tableKey.value.name
      }">
      {{ tableKey.value.description || 'Cliquez pour sélectionner cette table.' }}
    </p>
  </div>
</div>

<div *ngIf="selectedTable" class="mt-3">
  <h3>{{ selectedTable.name }}</h3>

  <p
    *ngIf="selectedTable.hint !== undefined"
    [innerHTML]="selectedTable.hint"></p>


  <table class="table table-bordered table-responsive">
    <thead>
      <tr>
        <th scope="col">{{ selectedTable.headers.firstCell }}</th>
        <th
          *ngFor="let column of selectedTable.headers.columns"
          scope="col">
          {{ column }}
        </th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of selectedTable.data; let i = index">
        <th scope="row">{{ selectedTable.headers.rows[i] }}</th>
        <ng-container *ngFor="let cell of row; let j = index">
          <td
            *ngIf="isFirstMergedCell(i, j) === hideMergedCell(i, j)"
            class="table-cell"
            [attr.rowspan]="getMergedCell(i, j)?.rowspan"
            [attr.colspan]="getMergedCell(i, j)?.colspan">
            <div class="input-group">
              <input
                type="text"
                class="form-control text-center"
                [(ngModel)]="answers[i][j]"
                [disabled]="correctAnswers[i][j] === 'disabled'"
                [ngClass]="{
                  'bg-success': results[i][j] === 'correct' && correctAnswers[i][j] !== 'disabled',
                  'bg-danger': results[i][j] === 'incorrect',
                  'text-white': results[i][j] === 'incorrect',
                  'bg-secondary': correctAnswers[i][j] === 'disabled'
                }"
                [attr.aria-describedby]="'answer_' + i + '-' + j"
              />
              <ng-container *ngIf="correctAnswers[i][j] !== 'disabled'">
                <button
                  class="btn btn-outline-info"
                  type="button"
                  [id]="'answer-' + i + '-' + j"
                  (click)="showAnswer(i, j)">
                  <ng-container
                    *ngIf="showingAllAnswers || showingAnswers[i][j]">
                    {{ correctAnswers[i][j] }}
                  </ng-container>
                  <i
                    *ngIf="!showingAllAnswers && !showingAnswers[i][j]"
                    class="fas fa-eye"></i>
                </button>
              </ng-container>
            </div>
          </td>
        </ng-container>
      </tr>
    </tbody>
  </table>
  <div class="d-flex justify-content-center mt-3">
    <button type="button" class="btn btn-success me-3" (click)="checkAnswers()">
      Vérifier
    </button>
    <button class="btn btn-secondary me-3" (click)="reset()">Réinitialiser</button>
    <button class="btn btn-info" (click)="showAnswers()">
      {{ showingAllAnswers ? 'Masquer' : 'Afficher' }} les réponses
    </button>
  </div>
</div>
